import vlc
import time
import requests
import json

def print_current_sets():
    with open('example.json','r',encoding='utf-8') as fp:
        json_output = json.loads(fp.read())["results"]
        channel_info = [i["channel_name"] for i in json_output]
        print(channel_info)



def play_radio():
    NTS_CHANNEL_1 = 'https://stream-relay-geo.ntslive.net/stream'
    NTS_CHANNEL_2 = 'https://stream-relay-geo.ntslive.net/stream2'

    radio_channel = ''
    radio_select = ''

    print_current_sets()
    while(radio_channel != '1' or radio_channel != '2'):
        radio_channel = input("Select radio station 1 or 2: ")
        print('[+] radio_channel value: ' + radio_channel)

    print("[+] Selection loop successfully exited")

    if radio_channel == '1':
        radio_select = NTS_CHANNEL_1
    elif radio_channel == '2':
        radio_select = NTS_CHANNEL_2
    else:
        print("Invalid usage: select 1 or 2")

    player = vlc.MediaPlayer(radio_select)
    print("[+] Player successfully initialized")

    player.play()
    time.sleep(1)

    input("Press enter to stop")

    player.stop()



def handle_menu_options(choice):
    if choice == '1':
        play_radio()

def main():

    with open('example.json','w', encoding='utf-8') as fp:
        r = requests.get('https://www.nts.live/api/v2/live')
        if(r.status_code == 200):
            print('[+] HTTP GET on nts.live/radio SUCCESS')
            fp.write(json.dumps(r.json(), indent=2))
            print('[+] Write to example.json SUCCESS')



    MENU_OPTIONS = {'1','2','3'}
    menu_primitive = -1 
    while(True):
        print("Welcome to NTS Radio tools.")
        print("(1) 24/7 Radio Channels")
        print("(2) Search Archived Mixes")
        print("(3) Search Archived Mixes")
        print("(exit) Ends Program")

        menu_primitive = input("Enter valid menu options: ")
        if menu_primitive == 'exit':
            break
        if menu_primitive not in MENU_OPTIONS:
            print("Invalid Option: Choose from {1,2,3,exit}")
        else:
            handle_menu_options(menu_primitive)



if __name__ == '__main__':
    main()
